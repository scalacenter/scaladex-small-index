<div class="announce instapaper_body md" data-path="README.md" id="readme">
 <article class="markdown-body entry-content" itemprop="text">
  <h1><a id="user-content-memcontinuationed" class="anchor" href="https://github.com/atry/memcontinuationed#memcontinuationed" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Memcontinuationed</h1> 
  <div align="right">
   <a href="https://travis-ci.org/Atry/memcontinuationed" target="_blank"><img alt="Build Status" src="https://camo.githubusercontent.com/038dce7057bfa497180272428cd90aaacf129cb6/68747470733a2f2f7472617669732d63692e6f72672f417472792f6d656d636f6e74696e756174696f6e65642e706e673f6272616e63683d6d6173746572" data-canonical-src="https://travis-ci.org/Atry/memcontinuationed.png?branch=master" style="max-width:100%;"></a>
  </div> 
  <p><strong>Memcontinuationed</strong> is an asynchronous memcached client for <a href="http://www.scala-lang.org/" target="_blank">Scala</a>. Memcontinuationed is the fastest memcached client on JVM, much faster than <a href="https://code.google.com/p/spymemcached/" target="_blank">spymemcached</a> or <a href="https://github.com/gwhalin/Memcached-Java-Client/wiki" target="_blank">Whalin's client</a>.</p> 
  <h2><a id="user-content-why-is-memcontinuationed-so-fast" class="anchor" href="https://github.com/atry/memcontinuationed#why-is-memcontinuationed-so-fast" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Why is Memcontinuationed so fast?</h2> 
  <h3><a id="user-content-reason-1-better-threading-model" class="anchor" href="https://github.com/atry/memcontinuationed#reason-1-better-threading-model" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Reason 1. Better threading model</h3> 
  <p>Memcontinuationed never blocks any threads. On the other hand, spymemcached does not block the IO thread but it does block the user's thread. All Memcontinuationed API are <a href="http://www.scala-lang.org/api/current/scala/util/continuations/package.html#suspendable=scala.util.continuations.package.cps%5BUnit%5D" target="_blank"><code>@suspendable</code></a>, which mean these methods can be invoked by a thread, and return to another thread.</p> 
  <h3><a id="user-content-reason-2-optimization-for-huge-number-of-iops" class="anchor" href="https://github.com/atry/memcontinuationed#reason-2-optimization-for-huge-number-of-iops" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Reason 2. Optimization for huge number of IOPS</h3> 
  <p>Memcontinuationed can merge multiply <code>get</code> or <code>gets</code> requests into one request. On the other hand, spymemcached sends all requests immediately, never waiting for previous response. The spymemcached way consumes more CPU and more TCP overheads than Memcontinuationed. Even worse, the spymemcached way is not compatible with <a href="http://wiki.open.qq.com/wiki/%E8%AE%BF%E9%97%AECMEM" target="_blank">some memcached server</a>.</p> 
  <p>Note: Because Memcontinuationed queues requests until all the previous response have been received, you may need to create a connection pool of <code>com.dongxiguo.memcontinuationed.Memcontinuationed</code> to maximize the IOPS.</p> 
  <h2><a id="user-content-a-sample-to-use-memcontinuationed" class="anchor" href="https://github.com/atry/memcontinuationed#a-sample-to-use-memcontinuationed" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>A sample to use Memcontinuationed</h2> 
  <div class="highlight highlight-source-scala">
   <pre><span class="pl-k">import</span> <span class="pl-v">com.dongxiguo.memcontinuationed.</span><span class="pl-v">Memcontinuationed</span>
<span class="pl-k">import</span> <span class="pl-v">com.dongxiguo.memcontinuationed.</span><span class="pl-v">StorageAccessor</span>
<span class="pl-k">import</span> <span class="pl-v">java.io.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">java.net.</span><span class="pl-v">_</span>
<span class="pl-k">import</span> <span class="pl-v">java.nio.channels.</span><span class="pl-v">AsynchronousChannelGroup</span>
<span class="pl-k">import</span> <span class="pl-v">java.util.concurrent.</span><span class="pl-v">Executors</span>
<span class="pl-k">import</span> <span class="pl-v">scala.util.continuations.</span><span class="pl-v">reset</span>
<span class="pl-k">import</span> <span class="pl-v">scala.util.control.Exception.</span><span class="pl-v">Catcher</span>

<span class="pl-k">object</span> <span class="pl-en">Sample</span> {

  <span class="pl-k">def</span> <span class="pl-en">main</span>(<span class="pl-v">args</span>: <span class="pl-en">Array</span>[<span class="pl-k">String</span>]) {
    <span class="pl-k">val</span> <span class="pl-en">threadPool</span> <span class="pl-k">=</span> <span class="pl-en">Executors</span>.newCachedThreadPool()
    <span class="pl-k">val</span> <span class="pl-en">channelGroup</span> <span class="pl-k">=</span> <span class="pl-en">AsynchronousChannelGroup</span>.withThreadPool(threadPool)

    <span class="pl-c"><span class="pl-c">//</span> The locator determines where the memcached server is.</span>
    <span class="pl-c"><span class="pl-c">//</span> You may want to implement ketama hashing here.</span>
    <span class="pl-k">def</span> <span class="pl-en">locator</span>(<span class="pl-v">accessor</span>: <span class="pl-en">StorageAccessor</span>[_]) <span class="pl-k">=</span> {
      <span class="pl-k">new</span> <span class="pl-en">InetSocketAddress</span>(<span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>, <span class="pl-c1">1978</span>)
    }

    <span class="pl-k">val</span> <span class="pl-en">memcontinuationed</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Memcontinuationed</span>(channelGroup, locator)

    <span class="pl-c"><span class="pl-c">//</span> The error handler</span>
    <span class="pl-k">implicit</span> <span class="pl-k">def</span> <span class="pl-en">catcher</span><span class="pl-k">:</span><span class="pl-en">Catcher</span>[<span class="pl-k">Unit</span>] <span class="pl-k">=</span> {
      <span class="pl-k">case</span> <span class="pl-v">e</span>: <span class="pl-en">Exception</span> <span class="pl-k">=&gt;</span>
        scala.<span class="pl-en">Console</span>.err.print(e)
        sys.exit(<span class="pl-k">-</span><span class="pl-c1">1</span>)
    }

    reset {
      memcontinuationed.set(<span class="pl-en">MyKey</span>(<span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>Hello, World!<span class="pl-pds">"</span></span>)
      <span class="pl-k">val</span> <span class="pl-en">result</span> <span class="pl-k">=</span> memcontinuationed.require(<span class="pl-en">MyKey</span>(<span class="pl-s"><span class="pl-pds">"</span>hello<span class="pl-pds">"</span></span>))
      assert(result <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">"</span>Hello, World!<span class="pl-pds">"</span></span>)
      println(result)
      sys.exit()
    }
  }
}

<span class="pl-c"><span class="pl-c">/**</span></span>
<span class="pl-c"> * `MyKey` specifies how to serialize the data of a key/value pair.</span>
<span class="pl-c"> <span class="pl-c">*/</span></span>
<span class="pl-k">case</span> <span class="pl-k">class</span> <span class="pl-en">MyKey</span>(<span class="pl-k">override</span> <span class="pl-k">val</span> <span class="pl-en">key</span><span class="pl-k">:</span> <span class="pl-k">String</span>) <span class="pl-k">extends</span> <span class="pl-e">StorageAccessor</span>[<span class="pl-k">String</span>] {

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">encode</span>(<span class="pl-v">output</span>: <span class="pl-en">OutputStream</span>, <span class="pl-v">data</span>: <span class="pl-k">String</span>, <span class="pl-v">flags</span>: <span class="pl-k">Int</span>) {
    output.write(data.getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>))
  }

  <span class="pl-k">override</span> <span class="pl-k">def</span> <span class="pl-en">decode</span>(<span class="pl-v">input</span>: <span class="pl-en">InputStream</span>, <span class="pl-v">flags</span>: <span class="pl-k">Int</span>)<span class="pl-k">:</span> <span class="pl-k">String</span> <span class="pl-k">=</span> {
    <span class="pl-k">val</span> <span class="pl-en">result</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Array</span>[<span class="pl-k">Byte</span>](input.available)
    input.read(result)
    <span class="pl-k">new</span> <span class="pl-en">String</span>(result, <span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>)
  }
}</pre>
  </div> 
  <p>There is something you need to know:</p> 
  <ul> 
   <li><code>get</code>, <code>set</code>, and most of other methods in <code>Memcontinuationed</code> are <code>@suspendable</code>. You must invoke them in <code>reset</code> or in another <code>@suspendable</code> function you defined.</li> 
   <li><code>get</code>, <code>set</code>, and most of other methods in <code>Memcontinuationed</code> accept an implicit parameter <code>Catcher</code>. You must use <code>Catcher</code> to handle exceptions from <code>@suspendable</code> functions, instead of <code>try</code>/<code>catch</code>.</li> 
   <li><code>MyKey</code> is the key you passed to server, which is a custom <code>StorageAccessor</code>. You should implement your own <code>StorageAccessor</code> for each type of data. If your value's format is <a href="http://code.google.com/p/protobuf/" target="_blank">Protocol Buffers</a>, you can use <code>com.dongxiguo.memcontinuationed.ProtobufAccessor</code> as your custom key's super class.</li> 
  </ul> 
  <h2><a id="user-content-build-configuration" class="anchor" href="https://github.com/atry/memcontinuationed#build-configuration" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Build configuration</h2> 
  <p>Add these lines to your <code>build.sbt</code> if you use <a href="http://www.scala-sbt.org/" target="_blank">Sbt</a>:</p> 
  <div class="highlight highlight-source-scala">
   <pre>libraryDependencies <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>com.dongxiguo<span class="pl-pds">"</span></span> <span class="pl-k">%%</span> <span class="pl-s"><span class="pl-pds">"</span>memcontinuationed<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>0.3.2<span class="pl-pds">"</span></span>
    
libraryDependencies <span class="pl-k">&lt;</span><span class="pl-k">++</span><span class="pl-k">=</span> scalaBinaryVersion { bv <span class="pl-k">=&gt;</span>
  bv <span class="pl-k">match</span> {
    <span class="pl-k">case</span> <span class="pl-s"><span class="pl-pds">"</span>2.10<span class="pl-pds">"</span></span> <span class="pl-k">=&gt;</span> {
      <span class="pl-en">Seq</span>()
    }
    <span class="pl-k">case</span> _ <span class="pl-k">=&gt;</span> {
      <span class="pl-en">Seq</span>(<span class="pl-s"><span class="pl-pds">"</span>org.scala-lang.plugins<span class="pl-pds">"</span></span> <span class="pl-k">%</span> s<span class="pl-s"><span class="pl-pds">"</span>scala-continuations-library_$bv<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.1<span class="pl-pds">"</span></span>)
    }
  }
}

libraryDependencies <span class="pl-k">&lt;</span><span class="pl-k">+</span><span class="pl-k">=</span> scalaVersion { sv <span class="pl-k">=&gt;</span>
  <span class="pl-k">if</span> (sv.startsWith(<span class="pl-s"><span class="pl-pds">"</span>2.10.<span class="pl-pds">"</span></span>)) {
    compilerPlugin(<span class="pl-s"><span class="pl-pds">"</span>org.scala-lang.plugins<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>continuations<span class="pl-pds">"</span></span> <span class="pl-k">%</span> sv)
  } <span class="pl-k">else</span> {
    compilerPlugin(<span class="pl-s"><span class="pl-pds">"</span>org.scala-lang.plugins<span class="pl-pds">"</span></span> <span class="pl-k">%</span> s<span class="pl-s"><span class="pl-pds">"</span>scala-continuations-plugin_$sv<span class="pl-pds">"</span></span> <span class="pl-k">%</span> <span class="pl-s"><span class="pl-pds">"</span>1.0.1<span class="pl-pds">"</span></span>)
  }
}

scalacOptions <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>-P:continuations:enable<span class="pl-pds">"</span></span></pre>
  </div> 
  <h3><a id="user-content-requirement" class="anchor" href="https://github.com/atry/memcontinuationed#requirement" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Requirement</h3> 
  <p>Memcontinuationed requires Scala 2.10.x or 2.11.x, and JRE 7.</p> 
  <h2><a id="user-content-links" class="anchor" href="https://github.com/atry/memcontinuationed#links" aria-hidden="true" target="_blank">
    <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
     <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
    </svg></a>Links</h2> 
  <ul> 
   <li><a href="http://central.maven.org/maven2/com/dongxiguo/memcontinuationed_2.11/0.3.2/memcontinuationed_2.11-0.3.2-javadoc.jar" target="_blank">The API documentation</a></li> 
   <li><a href="https://github.com/Atry/memcontinuationed/tree/master/src/test/scala/com/dongxiguo/memcontinuationed" target="_blank">Coding examples</a></li> 
  </ul> 
 </article>
</div>